<!DOCTYPE html >
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->
<head>
    <!-- BASE META -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- SITE TITLE -->
    <title>森度</title>

    <!--SITE INFO -->
    <meta name="robots" content="index,follow">
    <meta name="author" content="cuican">
    <meta name="application-name" content="森度">
    <meta name="keywords" content="Thonatos,Thonatos.Yang,Grimrock,Juy">
    <meta name="description" content=""/>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>

    <!-- INCLUDE STYLE -->
    <link href="http://cdn.bootcss.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- SITE FAVICONS -->
    <link rel="shortcut icon" href="/images/favicon.ico"/>

    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/style-old-ie.min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="/css/style.min.css">
    <!--<![endif]-->

</head>
<body>
<div class="layout">
  <!--sidebar-->
  <div class="sidebar">
    <!-- Side Start -->
    <!-- Siderbar  -->
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="http://thinkdo.github.io" alt="森度"><img class="pure-img" src="/images/osbloglg.png"/></a></h1>
            <h2 class="brand-tagline">
                <small>森度的博客</small>
            </h2>
        </hgroup>

        <div id="sidebar_nav" class="pure-menu pure-menu-open">
            <ul>
                
                <li><a href="/">Home</a></li>
                
                <li><a href="/archives">Archives</a></li>
                
                <li><a href="/author">About</a></li>
                
            </ul>
        </div>
    </div>
    <!-- Side End-->
</div>

  <!--content-->
  
<div class="content pure-g">
    <div class=" pure-u-1">
        <!-- A wrapper for all the blog posts start -->
        <a href="#menu" id="menuLink" class="menu-link">
    <span></span>
</a>
<div class="content-header">
    <div id="content-header-nav" class="pure-menu pure-menu-open">
        <ul>
            <li><a href="http://thinkdo.github.io">森度</a></li>
            
            <li><a href="/">Home</a></li>
            
            <li><a href="/archives">Archives</a></li>
            
            <li><a href="/author">About</a></li>
            
        </ul>
    </div>
</div>

        <div class="posts">
            <h1 class="content-subhead"> Post </h1>

            <!-- A single blog post start -->

          <section class="post">
            <header class="post-header">
              <h2 class="post-title">用react-redux改造弹框组件</h2>
              <p class="post-meta">
    <time class="post-category post-category-design" datetime="2016-07-10T13:22:06.000Z" itemprop="datePublished">
        2016-07-10
    </time>
    
</p>
            </header>
            <div class="post-banner">
            </div>
            <div class="post-description">
              <p>请先阅读<a href="http://cn.redux.js.org/docs/introduction/Motivation.html" target="_blank" rel="external">redux中文文档</a><br>对redux和react-redux有了一定的了解后，动手改造了用es6写的一个弹出框组件，目录结构如下图<br><img src="../../../../images/react-redux-catalog.png" alt="响应首部字段"></p>
<p>1、首先安装redux和react-redux，使用npm命令：npm install –save redux react-redux<br>2、接下来写<strong>展示组件</strong>，文件名为alertBox.js，内容如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">//“展示组件”不需要知道数据怎么变化，只需要用props获取需要动态展示的地方！</div><div class="line">import React, &#123; Component, PropTypes &#125; from 'react';</div><div class="line">export default class AlertBoxComponent extends Component&#123;</div><div class="line">	constructor(props)&#123;</div><div class="line">	    super(props);</div><div class="line">	&#125;</div><div class="line">	render()&#123;</div><div class="line">		return (</div><div class="line">			//show用于确定是否展示该alert框</div><div class="line">			&lt;div className=&#123;this.props.show?'dis':'undis'&#125;&gt;</div><div class="line">				&lt;div className='dialogMask'&gt;&lt;/div&gt;</div><div class="line">				&lt;section className='dialog'&gt;</div><div class="line">					//content用于展示alert框的内容</div><div class="line">					&lt;p className="info-notice"&gt;&#123;this.props.content&#125;&lt;/p&gt;</div><div class="line">					&lt;div className="close-btn"&gt;</div><div class="line">						//handleAlertCloseButton为点击关闭按钮时的回调函数</div><div class="line">						&lt;button onClick=&#123;() =&gt; &#123; this.props.handleAlertCloseButton() &#125;&#125;&gt;关闭&lt;/button&gt;</div><div class="line">					&lt;/div&gt;</div><div class="line">				&lt;/section&gt;</div><div class="line">			&lt;/div&gt;</div><div class="line">		);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">AlertBoxComponent.propTypes = &#123;</div><div class="line">	handleAlertCloseButton: PropTypes.func.isRequired</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>3、分析得知共两个action，一个是弹出框弹出，一个是弹出框关闭。action.js如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line"> * action 类型</div><div class="line"> */</div><div class="line">export const SHOW_ALERT = &apos;SHOW_ALERT&apos;;</div><div class="line">export const CLOSE_ALERT = &apos;CLOSE_ALERT&apos;;</div><div class="line"></div><div class="line">/*</div><div class="line"> * action 函数</div><div class="line"> */</div><div class="line">export function showAlert(content) &#123;</div><div class="line">  return &#123; type: SHOW_ALERT,content &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export function closeAlert() &#123;</div><div class="line">  return &#123; type: CLOSE_ALERT &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>4、reducer根据action的两种类型，返回对应的两个状态。reducer.js如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; SHOW_ALERT,CLOSE_ALERT,showAlert,closeAlert &#125; <span class="keyword">from</span> <span class="string">'./action'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> initialState = &#123;</div><div class="line">  <span class="attr">content</span>: <span class="string">''</span>,</div><div class="line">  <span class="attr">show</span>: <span class="literal">false</span> </div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">alertReducer</span>(<span class="params">state = initialState, action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span>(action.type) &#123;</div><div class="line">  	<span class="keyword">case</span> SHOW_ALERT:</div><div class="line">  		<span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123;</div><div class="line">        	<span class="attr">content</span>: action.content,</div><div class="line">        	<span class="attr">show</span>:<span class="literal">true</span></div><div class="line">      	&#125;)</div><div class="line">  	<span class="keyword">case</span> CLOSE_ALERT:</div><div class="line">  		<span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123;</div><div class="line">        	<span class="attr">show</span>:<span class="literal">false</span></div><div class="line">      	&#125;)</div><div class="line">  	<span class="keyword">default</span>:</div><div class="line">  		<span class="keyword">return</span> state;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>5、这时候弹出框组件写好了，那么如何在页面中使用组件并触发组件？首先写要引用弹出框组件的父组件，bind.js如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></div><div class="line"><span class="keyword">import</span> &#123; showAlert,closeAlert &#125; <span class="keyword">from</span> <span class="string">'../state/action'</span>;</div><div class="line"><span class="comment">//引入alertBox</span></div><div class="line"><span class="keyword">import</span> AlertBox <span class="keyword">from</span> <span class="string">'../commonComponent/alertBox'</span>;</div><div class="line"><span class="comment">//这里说明一下，如果css过于庞大，可以单独引入到html中，如果很小可以通过webpack构建到js文件中，构建到js中时使用import导入。import  '../../../css/page.css';</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BodyDiv</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</div><div class="line">	<span class="keyword">constructor</span>(props) &#123;</div><div class="line">	    <span class="keyword">super</span>(props);</div><div class="line">	&#125;</div><div class="line">	showAlert(e)&#123;</div><div class="line">		<span class="keyword">this</span>.props.dispatch(showAlert(<span class="string">'我就是弹出框哦，弹出来喽！'</span>));</div><div class="line">	&#125;</div><div class="line">	render()&#123;</div><div class="line">		<span class="keyword">const</span> &#123; dispatch,content, show &#125; = <span class="keyword">this</span>.props;</div><div class="line">		<span class="keyword">return</span>(</div><div class="line">			&lt;section&gt;</div><div class="line">			    &lt;input type='button' value='弹框出来！' onClick=&#123;e=&gt;this.showAlert(e)&#125; /&gt;</div><div class="line">				&lt;AlertBox</div><div class="line">					content=&#123;content&#125;</div><div class="line">					show=&#123;show&#125;</div><div class="line">				  	handleAlertCloseButton=&#123;()=&gt;dispatch(closeAlert())&#125;/&gt; </div><div class="line">			&lt;/section&gt;</div><div class="line">		);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">function select(state) &#123;</div><div class="line">  return &#123;</div><div class="line">    content: state.content,</div><div class="line">    show: state.show</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">//这里必须用connect，将dispatch和state注入到BodyDiv中，在BodyDiv中通过props获取。</div><div class="line">export default connect(select)(BodyDiv);</div></pre></td></tr></table></figure></p>
<p>6、入口文件(bindNumber.js)中需要使用到Provider包装父组件，否则父组件无法使用store。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> ReactDom <span class="keyword">from</span> <span class="string">'react-dom'</span>;</div><div class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</div><div class="line"><span class="keyword">import</span> alertReducer <span class="keyword">from</span> <span class="string">'../state/reducer'</span>;</div><div class="line"><span class="keyword">import</span> BodyDiv <span class="keyword">from</span> <span class="string">'../myBusiness/bind'</span>;</div><div class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></div><div class="line"><span class="comment">//根据alertReducer创建store</span></div><div class="line"><span class="keyword">let</span> store = createStore(alertReducer);</div><div class="line"><span class="keyword">let</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">'info'</span>);</div><div class="line">ReactDom.render(</div><div class="line">	<span class="xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></div><div class="line">    	<span class="tag">&lt;<span class="name">BodyDiv</span> /&gt;</span></div><div class="line"> 	<span class="tag">&lt;/<span class="name">Provider</span>&gt;</span>,</div><div class="line">  	rootElement</div><div class="line">);</div></pre></td></tr></table></figure></p>
<p>7、最后是Html，bindNumber.html<br>这里注明，react、jquery、react-dom以及page.css都可以通过webpack构建到bindNumber.js中。而实际中，因为这几个文件过于庞大，为了使bindNumber.js下载的快一些，可以单独加载庞大的js或者css，剩余小的js或者css合并到bindNumber.js中。这就是webpack的魅力所在，可以参考我的<a href="/2016/07/05/webpack/">上一篇文章</a></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"format-detection"</span> <span class="attr">content</span>=<span class="string">"telephone=no"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>绑定号码<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"../../favicon.ico"</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">type</span>=<span class="string">"image/x-icon"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"../css/page.css"</span>&gt;</span>	</div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">section</span> <span class="attr">id</span>=<span class="string">"info"</span> &gt;</span><span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"../jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"../react-dom.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"../react.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bindNumber.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
            </div>
          </section>

            <nav class="pagination" role="pagination">
    
    <a class="newer-posts" href="/2016/07/05/webpack/">
        ← webpack+react
    </a>
    
    <span class="page-number">•</span>
    
    <a class="older-posts" href="/2016/07/26/httpDeeper2/">
        二、http详细理解 →
    </a>
    
</nav>
            <div id="comment" class="comments-area">
    <h1 class="title"><a href="#disqus_comments" name="disqus_comments">Comments</a></h1>

    
    <div id="ds-thread" class="ds-thread" data-thread-key="2016/07/10/react-redux/" data-title="用react-redux改造弹框组件" data-url="http://thinkdo.github.io/2016/07/10/react-redux/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"datoublog"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
    
</div>
            <!-- page-nav-start -->
            <div class="clear" style="height: 25px;">&nbsp;</div>
            <!-- A single blog post end -->
        </div>

        <!-- A wrapper for all the blog posts end -->
        <div class="footer">
    <p></p>
</div>
    </div>
</div>

</div>
<!-- footer start -->
<!-- Le javascript
================================================== -->
<!-- BASE JAVASCRIPT -->
<script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://www.thonatos.com/engine/wp-content/themes/Jure-v3/style/js/vendor/jquery-1.11.0.min.js"><\/script>')</script>
<script src="http://cdn.bootcss.com/highlight.js/8.1/highlight.min.js"></script>
<!--<script src="/style/js/plugin/jquery.highlight/highlight.min.js"></script>-->
<script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script>
<script src="http://cdn.bootcss.com/jquery.nicescroll/3.5.1/jquery.nicescroll.min.js"></script>
<!-- CUSTOM JAVASCRIPT -->
<!-- PLUGIN JAVASCRIPT -->
<script src="/js/app.js"></script>

</body>
</html>
